apiVersion: tekton.dev/v1beta1
kind: Task
metadata:
  name: develop-deploy-to-gke
spec:
  params:
    - name: username
      description: GitHub username
      valueFrom:
        secretKeyRef:
          name: abdul-github-credentials
          key: username
    - name: password
      description: GitHub password
      valueFrom:
        secretKeyRef:
          name: abdul-github-credentials
          key: password
  steps:
    - name: fetch-source
      image: alpine/git
      args:
        - clone
        - --single-branch
        - --branch
        - $(params.branch)
        - https://$(params.username):$(params.password)@github.com/frankkamando/GasManagementSystemAPI.git
        - /workspace/source
    - name: gke-deploy
      image: google/cloud-sdk:latest
      command:
        - sh
      args:
        - -c
        - |
          gcloud container clusters get-credentials lpg-mis --region africa-south1
          kubectl apply -f develop-deployment.yaml 
# gcloud auth activate-service-account --key-file=/.tekton/gcp-auth-key.json